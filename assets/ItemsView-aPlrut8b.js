import{D as Q,d as re,s as n,t as ne,v as de,x as me,c as b,a as t,b as i,y as M,w as u,n as L,e as a,F as ce,h as g,f as ve,z as j,i as O,p as U,E as J,A as P,C as X,q as D}from"./index-DyApI3EZ.js";import{a as y,b as q}from"./index-C38VEynT.js";import{s as pe,a as fe,b as $,c as be,d as F,e as Y,f as z,g as ge}from"./index-DoIaX_hJ.js";import{s as Z}from"./index-C-MvNh0Y.js";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ee=()=>{};function ye(C,v){function p(...r){return new Promise((f,m)=>{Promise.resolve(C(()=>v.apply(this,r),{fn:v,thisArg:this,args:r})).then(f).catch(m)})}return p}function ke(C,v={}){let p,r,f=ee;const m=V=>{clearTimeout(V),f(),f=ee};return V=>{const x=Q(C),k=Q(v.maxWait);return p&&m(p),x<=0||k!==void 0&&k<=0?(r&&(m(r),r=null),Promise.resolve(V())):new Promise((I,c)=>{f=v.rejectOnCancel?c:I,k&&!r&&(r=setTimeout(()=>{p&&m(p),r=null,I(V())},k)),p=setTimeout(()=>{r&&m(r),r=null,I(V())},x)})}}function we(C,v=200,p={}){return ye(ke(v,p),C)}const xe={class:"flex justify-between gap-4 p-2"},Ve=["src"],Ie=["title"],Ce={class:"flex items-center justify-center w-full"},_e={class:"flex items-center justify-center w-full"},Ue={key:0,class:"flex items-center justify-center w-full aspect-square"},$e={key:1,class:"flex flex-col gap-6"},Ne={key:0,class:"text-red-500"},Se={key:0,class:"text-red-500"},Ee={class:"flex items-center gap-2"},De={key:0,class:"text-red-500"},Fe={class:"mt-6"},he={key:0,class:"flex items-center justify-center w-full aspect-square"},Ae={key:1,class:"flex flex-col gap-6"},Re={key:0,class:"text-red-500"},Te={key:0,class:"text-red-500"},je={class:"flex items-center gap-2"},qe={key:0,class:"text-red-500"},Me={class:"mt-6"},We=re({__name:"ItemsView",setup(C){const v=[{label:"Armamento",value:"armamento"},{label:"Autômato",value:"automato"},{label:"Akuma no Mi",value:"akuma_no_mi"},{label:"Consumível",value:"consumivel"},{label:"Criatura",value:"criatura"},{label:"Cômodo",value:"comodo"},{label:"Diverso",value:"diverso"},{label:"Equipamento",value:"equipamento"},{label:"Transporte",value:"transporte"},{label:"Receita",value:"receita"},{label:"Permissão",value:"permissao"},{label:"Profissão",value:"profissao"}],p={global:{value:null,matchMode:P.CONTAINS},name:{operator:X.AND,constraints:[{value:null,matchMode:P.STARTS_WITH}]},category:{operator:X.AND,constraints:[{value:null,matchMode:P.EQUALS}]}},r=n([]),f=n([]),m=n(p),w=n(0),V=n(["id","name","category"]),x=n(!1),k=n(10),I=n(0),c=n(""),N=n(!1),h=n(!1),s=n({name:"",description:"",category:"armamento",image_url:"",submitted:!1}),A=n(!1),R=n(!1),o=n({id:-1,name:"",description:"",category:"",image_url:"",submitted:!1}),W=ne(()=>c.value!==""),T=n(!1),B=n(""),_=n(null),S=async()=>{x.value=!0,f.value=[];const e=await D().items.getPagedItems({page:w.value/k.value+1,size:k.value});return x.value=!1,e.success?(I.value=e.total,e.result):(console.error("Failed to fetch items",e.message),[])},le=we(async()=>{if(m.value.global.value===null||m.value.global.value===""){S();return}console.log("Searching items..."),x.value=!0,r.value=[];const e=await D().items.searchItems({name:m.value.global.value});if(x.value=!1,!e.success)return console.error("Failed to search items",e.message),[];f.value=e.result,I.value=e.result.length,console.log("Done searching items"),f.value.length>0&&(w.value=f.value[0].id)},700),G=()=>{m.value=p},ae=()=>{h.value=!0},K=()=>{h.value=!1,s.value={name:"",description:"",category:"armamento",image_url:"",submitted:!1}},te=async()=>{if(s.value.submitted=!0,!s.value.name||!s.value.description||!s.value.category||!s.value.image_url)return;N.value=!0;const d=D();try{const e=await d.items.createItem({name:s.value.name,description:s.value.description,category:s.value.category,image_url:s.value.image_url});!e.success||!e.id?(console.error("Failed to create item",e.message),c.value=`Erro ao criar item: ${e.message}`):(c.value="Item criado com sucesso!",r.value=await S())}catch(e){console.error("Failed to create item",e),N.value=!1,c.value=`Erro interno ao criar item: ${e==null?void 0:e.toString()}`;return}K(),N.value=!1,s.value={name:"",description:"",category:"armamento",image_url:"",submitted:!1}},ie=d=>{o.value={id:d.id,name:d.name,description:d.description,category:d.category,image_url:d.image_url,submitted:!1},R.value=!0},H=()=>{R.value=!1,o.value={id:-1,name:"",description:"",category:"",image_url:"",submitted:!1}},oe=async()=>{if(o.value.submitted=!0,!o.value.name||!o.value.description||!o.value.category||!o.value.image_url)return;A.value=!0;const d=D();try{const e=await d.items.updateItem({id:o.value.id,name:o.value.name,description:o.value.description,category:o.value.category,image_url:o.value.image_url});e.success?(c.value="Item salvo com sucesso!",r.value=await S()):(console.error("Failed to update item",e.message),c.value=`Erro ao salvar item: ${e.message}`)}catch(e){console.error("Failed to update item",e),c.value=`Erro interno ao salvar item: ${e==null?void 0:e.toString()}`}H(),A.value=!1,o.value={id:-1,name:"",description:"",category:"",image_url:"",submitted:!1}},se=async d=>{if(B.value=`Deseja excluir o item "${d.name}"?`,T.value=!0,await new Promise(e=>{const l=setInterval(()=>{_.value!==null&&(clearInterval(l),e())},100)}),T.value=!1,!_.value){_.value=null;return}_.value=null;try{await D().items.removeItem(d.id),c.value="Item excluído com sucesso!",r.value=await S()}catch(e){console.error("Failed to delete item",e==null?void 0:e.toString()),c.value=`Erro ao excluir item: ${e==null?void 0:e.toString()}`}},ue=d=>{const e=v.find(l=>l.value===d);return e?e.label:"???"};return de(()=>{G()}),me([w,k],async()=>{if(f.value.length>0){r.value=f.value.slice(w.value,w.value+k.value);return}console.log("Fetching items..."),r.value=await S(),console.log("Done fetching items")},{immediate:!0}),(d,e)=>(g(),b(ce,null,[t("div",{class:L(a(O)(`
        flex flex-col items-center justify-center
        size-full
      `))},[i(a(ge),{value:r.value,size:"small","data-key":"id","filter-display":"menu","global-filter-fields":V.value,"sort-field":"id","sort-order":1,"table-class":"min-w-[60rem]",class:L(a(O)(`
          p-8
          rounded-xl
          bg-[#18181b]
        `)),filters:m.value,"onUpdate:filters":e[3]||(e[3]=l=>m.value=l)},M({header:u(()=>[t("div",xe,[i(a(y),{label:"Novo Item",icon:"pi pi-plus",onClick:ae}),i(a(y),{class:"mr-auto",type:"button",icon:"pi pi-filter-slash",label:"Limpar filtros",outlined:"",onClick:e[0]||(e[0]=l=>G())}),i(a(pe),{class:"ml-auto"},{default:u(()=>[i(a(fe),null,{default:u(()=>e[19]||(e[19]=[t("i",{class:"pi pi-search"},null,-1)])),_:1}),i(a($),{placeholder:"Pesquisar",modelValue:m.value.global.value,"onUpdate:modelValue":e[1]||(e[1]=l=>m.value.global.value=l),onKeyup:a(le)},null,8,["modelValue","onKeyup"])]),_:1})])]),footer:u(()=>[i(a(be),{rows:k.value,totalRecords:I.value,first:w.value,"onUpdate:first":e[2]||(e[2]=l=>w.value=l)},null,8,["rows","totalRecords","first"])]),default:u(()=>[i(a(F),{field:"image_url",header:"Imagem"},{body:u(({data:l})=>[t("img",{src:l.image_url,alt:"Imagem",class:"w-12 h-12 object-contain"},null,8,Ve)]),_:1}),i(a(F),{field:"name",header:"Nome",sortable:""},{body:u(({data:l})=>[ve(j(l.name),1)]),filter:u(({filterModel:l})=>[i(a($),{type:"text",placeholder:"...",modelValue:l.value,"onUpdate:modelValue":E=>l.value=E},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(a(F),{field:"description",header:"Descrição"},{body:u(({data:l})=>[t("span",{title:l.description},j(l.description.length>30?l.description.slice(0,30)+"...":l.description),9,Ie)]),_:1}),i(a(F),{field:"category",header:"Categoria",sortable:""},{body:u(({data:l})=>[i(a(Y),{value:ue(l.category),severity:"contrast"},null,8,["value"])]),filter:u(({filterModel:l})=>[i(a(z),{options:v,placeholder:"Selecione uma","option-label":"label","option-value":"value","show-clear":"",modelValue:l.value,"onUpdate:modelValue":E=>l.value=E},{option:u(E=>[i(a(Y),{value:E.option.label,severity:"contrast"},null,8,["value"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),i(a(F),{class:"max-w-52"},{body:u(({data:l})=>[t("div",{class:L(a(O)(`
                flex items-center justify-end
                gap-3
                h-12
              `))},[i(a(y),{type:"button",size:"small",severity:"primary",icon:"pi pi-pencil",label:"Editar",raised:"",onClick:()=>ie(l)},null,8,["onClick"]),i(a(y),{type:"button",size:"small",severity:"danger",icon:"pi pi-trash",label:"Excluir",raised:"",onClick:()=>se(l)},null,8,["onClick"])],2)]),_:1})]),_:2},[x.value?{name:"empty",fn:u(()=>[e[20]||(e[20]=t("div",{class:"flex items-center justify-center gap-2 p-3"},[t("i",{class:"pi pi-spin pi-spinner"}),t("i",null,"Carregando dados...")],-1))]),key:"0"}:{name:"empty",fn:u(()=>[e[21]||(e[21]=t("div",{class:"flex items-center justify-center p-3"},[t("i",null,"Nenhum item encontrado.")],-1))]),key:"1"}]),1032,["value","global-filter-fields","class","filters"])],2),i(a(q),{class:"w-[450px]",header:"Aviso",closable:!1,modal:!0,visible:W.value,"onUpdate:visible":e[5]||(e[5]=l=>W.value=l)},{footer:u(()=>[i(a(y),{label:"OK",icon:"pi pi-check",onClick:e[4]||(e[4]=l=>c.value="")})]),default:u(()=>[t("div",Ce,[t("span",null,j(c.value),1)])]),_:1},8,["visible"]),i(a(q),{class:"w-[450px]",header:"Confirmação",closable:!1,modal:!0,visible:T.value,"onUpdate:visible":e[8]||(e[8]=l=>T.value=l)},{footer:u(()=>[i(a(y),{label:"Sim",icon:"pi pi-check",onClick:e[6]||(e[6]=l=>_.value=!0)}),i(a(y),{label:"Não",icon:"pi pi-times",text:"",onClick:e[7]||(e[7]=l=>_.value=!1)})]),default:u(()=>[t("div",_e,[t("span",null,j(B.value),1)])]),_:1},8,["visible"]),i(a(q),{class:"w-[450px]",header:"Criar um Novo Item",closable:!1,modal:!0,visible:h.value,"onUpdate:visible":e[13]||(e[13]=l=>h.value=l)},M({default:u(()=>[N.value?(g(),b("div",Ue,e[22]||(e[22]=[t("i",{class:"pi pi-spin pi-spinner"},null,-1)]))):(g(),b("div",$e,[t("div",null,[e[23]||(e[23]=t("label",{for:"name",class:"block font-bold mb-3"},"Nome",-1)),i(a($),{id:"name",required:!0,autofocus:"",invalid:s.value.submitted&&!s.value.name,modelValue:s.value.name,"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.name=l),modelModifiers:{trim:!0},fluid:""},null,8,["invalid","modelValue"]),s.value.submitted&&!s.value.name?(g(),b("small",Ne," O nome é obrigatório. ")):U("",!0)]),t("div",null,[e[24]||(e[24]=t("label",{for:"description",class:"block font-bold mb-3"}," Descrição ",-1)),i(a(Z),{id:"description",required:!0,autofocus:"",invalid:s.value.submitted&&!s.value.description,modelValue:s.value.description,"onUpdate:modelValue":e[10]||(e[10]=l=>s.value.description=l),modelModifiers:{trim:!0},fluid:""},null,8,["invalid","modelValue"]),s.value.submitted&&!s.value.description?(g(),b("small",Se," A descrição é obrigatória. ")):U("",!0)]),t("div",null,[e[25]||(e[25]=t("label",{for:"image_url",class:"block font-bold mb-3"}," URL da Imagem ",-1)),t("div",Ee,[i(a($),{id:"image_url",required:!0,autofocus:"",invalid:s.value.submitted&&!s.value.image_url,modelValue:s.value.image_url,"onUpdate:modelValue":e[11]||(e[11]=l=>s.value.image_url=l),modelModifiers:{trim:!0},fluid:""},null,8,["invalid","modelValue"]),t("div",{class:"flex-shrink-0 w-12 h-12 bg-center bg-contain bg-no-repeat",style:J({"background-image":`url(${s.value.image_url})`})},null,4)]),s.value.submitted&&!s.value.image_url?(g(),b("small",De," O URL da imagem é obrigatório. ")):U("",!0)]),t("div",null,[e[26]||(e[26]=t("label",{for:"category",class:"block font-bold mb-3"},"Categoria",-1)),i(a(z),{id:"category",name:"category",options:v,"option-label":"label","option-value":"value",modelValue:s.value.category,"onUpdate:modelValue":e[12]||(e[12]=l=>s.value.category=l)},null,8,["modelValue"])])]))]),_:2},[N.value?void 0:{name:"footer",fn:u(()=>[t("div",Fe,[i(a(y),{label:"Salvar",icon:"pi pi-check",onClick:te}),i(a(y),{label:"Cancelar",icon:"pi pi-times",text:"",onClick:K})])]),key:"0"}]),1032,["visible"]),i(a(q),{class:"w-[450px]",header:"Editar Item",closable:!1,modal:!0,visible:R.value,"onUpdate:visible":e[18]||(e[18]=l=>R.value=l)},M({default:u(()=>[A.value?(g(),b("div",he,e[27]||(e[27]=[t("i",{class:"pi pi-spin pi-spinner"},null,-1)]))):(g(),b("div",Ae,[t("div",null,[e[28]||(e[28]=t("label",{for:"name",class:"block font-bold mb-3"},"Nome",-1)),i(a($),{id:"name",required:!0,autofocus:"",invalid:o.value.submitted&&!o.value.name,modelValue:o.value.name,"onUpdate:modelValue":e[14]||(e[14]=l=>o.value.name=l),modelModifiers:{trim:!0},fluid:""},null,8,["invalid","modelValue"]),o.value.submitted&&!o.value.name?(g(),b("small",Re," O nome é obrigatório. ")):U("",!0)]),t("div",null,[e[29]||(e[29]=t("label",{for:"description",class:"block font-bold mb-3"}," Descrição ",-1)),i(a(Z),{id:"description",required:!0,autofocus:"",invalid:o.value.submitted&&!o.value.description,modelValue:o.value.description,"onUpdate:modelValue":e[15]||(e[15]=l=>o.value.description=l),modelModifiers:{trim:!0},fluid:""},null,8,["invalid","modelValue"]),o.value.submitted&&!o.value.description?(g(),b("small",Te," A descrição é obrigatória. ")):U("",!0)]),t("div",null,[e[30]||(e[30]=t("label",{for:"image_url",class:"block font-bold mb-3"}," URL da Imagem ",-1)),t("div",je,[i(a($),{id:"image_url",required:!0,autofocus:"",invalid:o.value.submitted&&!o.value.image_url,modelValue:o.value.image_url,"onUpdate:modelValue":e[16]||(e[16]=l=>o.value.image_url=l),modelModifiers:{trim:!0},fluid:""},null,8,["invalid","modelValue"]),t("div",{class:"flex-shrink-0 w-12 h-12 bg-center bg-contain bg-no-repeat",style:J({"background-image":`url(${o.value.image_url})`})},null,4)]),o.value.submitted&&!o.value.image_url?(g(),b("small",qe," O URL da imagem é obrigatório. ")):U("",!0)]),t("div",null,[e[31]||(e[31]=t("label",{for:"category",class:"block font-bold mb-3"},"Categoria",-1)),i(a(z),{id:"category",name:"category",options:v,"option-label":"label","option-value":"value",modelValue:o.value.category,"onUpdate:modelValue":e[17]||(e[17]=l=>o.value.category=l)},null,8,["modelValue"])])]))]),_:2},[A.value?void 0:{name:"footer",fn:u(()=>[t("div",Me,[i(a(y),{label:"Salvar",icon:"pi pi-check",onClick:oe}),i(a(y),{label:"Cancelar",icon:"pi pi-times",text:"",onClick:H})])]),key:"0"}]),1032,["visible"])],64))}});export{We as default};
